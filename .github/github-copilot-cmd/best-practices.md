# Best Practices â€” Catalogue par Domaine

Ce fichier contient les bonnes pratiques Ã  injecter dans les commandes gÃ©nÃ©rÃ©es par `/create-cmd`.
Il est enrichi automatiquement au fur et Ã  mesure de la crÃ©ation de nouvelles commandes.

---

## ğŸŒ General

RÃ¨gles applicables Ã  **TOUTES** les commandes :

### ExÃ©cution
- **Pas d'interactif** â€” Aucune commande demandant une saisie utilisateur
- **Exit silencieux** â€” Si rien Ã  faire, terminer sans message ni erreur
- **Pas de verbose** â€” Messages concis, uniquement l'essentiel
- **Pas de signatures** â€” Jamais de "Generated by...", "Created with..." ou Ã©quivalent

### Validation
- **PrÃ©requis AVANT exÃ©cution** â€” Toujours vÃ©rifier les conditions avant de commencer
- **Fail fast** â€” ArrÃªter dÃ¨s qu'un prÃ©requis n'est pas rempli
- **Messages d'erreur clairs** â€” Reporter les erreurs sans verbositÃ© excessive

### Structure
- **Sections obligatoires** â€” Description, Allowed Tools, Validation, Workflow, Rules
- **Workflow numÃ©rotÃ©** â€” Ã‰tapes claires et ordonnÃ©es
- **Arguments documentÃ©s** â€” Expliquer comment `$ARGUMENTS` est utilisÃ©

---

## ğŸ”€ Git

### Commits
- **Format conventionnel** â€” `type(scope): description`
- **Scope OBLIGATOIRE** â€” Jamais de commit sans scope : `fix(auth):` pas `fix:`
- **Types standards** : `feat`, `fix`, `update`, `refactor`, `docs`, `chore`, `test`
- **Max 72 caractÃ¨res** â€” Ligne unique, concise
- **Pas de point final** â€” Ã‰conomie d'espace
- **PrÃ©sent** â€” "add" pas "added"
- **Minuscule aprÃ¨s `:` â€” `fix(auth): typo` pas `fix(auth): Typo`

### DÃ©duction automatique

- **Scope depuis path** â€” Extraire le scope du chemin : `src/auth/login.ts` â†’ `auth`
- **Type depuis pattern** â€” Mapper le type selon le changement dÃ©tectÃ© :

| Pattern | Type |
|---------|------|
| Nouveau fichier fonctionnel | `feat` |
| Fix, correction, patch | `fix` |
| DÃ©pendances, config | `update` |
| Restructuration sans changement comportement | `refactor` |
| README, comments, docs | `docs` |
| Tests | `test` |
| CI, scripts, maintenance | `chore` |

### Mode preview
- **Dry-run** â€” Toujours proposer un mode preview (`--dry-run`) pour les actions destructives ou importantes

### Workflow Git
- **Atomic commits** â€” Un commit = un changement logique
- **Stage explicite** â€” Toujours `git add` avant commit
- **VÃ©rifier le diff** â€” Analyser `git diff --cached` avant commit
- **Push automatique** â€” Sauf si spÃ©cifiÃ© autrement

### Contexte Ã  collecter
```bash
git status                    # Ã‰tat actuel
git diff HEAD                 # Changements non commitÃ©s
git branch --show-current     # Branche courante
git log --oneline -10         # Historique rÃ©cent
```

---

## ğŸŒ API

### RequÃªtes
- **Timeout dÃ©fini** â€” Toujours spÃ©cifier un timeout
- **Retry logic** â€” RÃ©essayer sur erreurs transitoires (5xx, timeout)
- **Rate limiting** â€” Respecter les limites, implÃ©menter backoff

### Gestion des erreurs
- **Codes HTTP** â€” GÃ©rer explicitement 4xx et 5xx
- **Messages d'erreur** â€” Extraire et afficher le message de l'API
- **Fallback** â€” PrÃ©voir un comportement dÃ©gradÃ© si possible

### SÃ©curitÃ©
- **Pas de secrets en dur** â€” Variables d'environnement uniquement
- **Headers auth** â€” Bearer token, API key selon le service

---

## ğŸ“ Files

### Manipulation
- **Chemins absolus** â€” Ou relatifs au root du projet
- **VÃ©rifier existence** â€” Avant lecture/Ã©criture
- **Backup avant modif** â€” Pour les fichiers critiques

### Permissions
- **VÃ©rifier droits** â€” Avant Ã©criture
- **Respecter .gitignore** â€” Ne pas toucher aux fichiers ignorÃ©s

### Nettoyage
- **Supprimer les temp** â€” Nettoyer les fichiers temporaires crÃ©Ã©s
- **Pas de fichiers orphelins** â€” Toujours nettoyer aprÃ¨s soi

---

## ğŸ³ Docker

### Build
- **Multi-stage** â€” RÃ©duire la taille des images
- **Cache layers** â€” Ordonner les instructions pour maximiser le cache
- **Tags explicites** â€” Pas de `:latest` en production

### Run
- **Cleanup** â€” `--rm` pour les conteneurs temporaires
- **Logs** â€” Rediriger ou limiter les logs
- **Resources** â€” Limiter CPU/memory si nÃ©cessaire

### Registry
- **Login sÃ©curisÃ©** â€” Via variables d'environnement
- **Push aprÃ¨s tag** â€” Toujours taguer avant push

---

## ğŸ“¦ NPM / Yarn

### Installation
- **Lockfile** â€” Toujours committer `package-lock.json` ou `yarn.lock`
- **CI mode** â€” Utiliser `npm ci` en CI, pas `npm install`

### Publication
- **Version bump** â€” Suivre semver
- **Changelog** â€” Mettre Ã  jour avant publish
- **Dry-run** â€” Tester avec `--dry-run` avant publish rÃ©el

### Scripts
- **Noms standards** â€” `build`, `test`, `start`, `lint`
- **Pre/post hooks** â€” Utiliser pour automatiser

---

## ğŸš€ CI/CD

### Pipelines
- **Fail fast** â€” ArrÃªter au premier Ã©chec
- **ParallÃ©liser** â€” Jobs indÃ©pendants en parallÃ¨le
- **Cache dependencies** â€” AccÃ©lÃ©rer les builds

### DÃ©ploiement
- **Environnements sÃ©parÃ©s** â€” dev, staging, prod
- **Rollback prÃ©vu** â€” Toujours pouvoir revenir en arriÃ¨re
- **Health checks** â€” VÃ©rifier aprÃ¨s dÃ©ploiement

### Secrets
- **Variables CI** â€” Jamais en dur dans le code
- **Rotation** â€” PrÃ©voir la rotation des secrets
- **Audit** â€” Logger les accÃ¨s aux secrets

---

## ğŸ”§ Terminal

### Commandes
- **Pas d'interactif** â€” Ã‰viter les prompts (`-y`, `--yes`, `--non-interactive`)
- **Codes de sortie** â€” VÃ©rifier `$?` ou `$LASTEXITCODE`
- **Timeout** â€” Limiter les commandes longues

### Output
- **Redirection** â€” Capturer stdout et stderr
- **Parsing** â€” Utiliser des formats parsables (JSON, CSV)
- **Truncate** â€” Limiter l'output pour Ã©viter le spam

---

## ğŸ“ Documentation

### Format
- **Markdown** â€” Standard pour la doc
- **Sections claires** â€” Headers hiÃ©rarchiques
- **Exemples** â€” Toujours inclure des exemples d'usage

### Maintenance
- **Ã€ jour** â€” Mettre Ã  jour quand le code change
- **Changelog** â€” Documenter les changements importants

### CHANGENOTES System
- **Frontmatter YAML** â€” MÃ©tadonnÃ©es parsables (`type`, `scope`, `date`, `hash`, `branch`)
- **Nommage horodatÃ©** â€” `YYYY-MM-DD_HHMMSS_type_scope.md` pour tri naturel
- **AtomicitÃ©** â€” Une note = un commit

### CHANGELOG
- **Keep a Changelog** â€” Respecter le standard https://keepachangelog.com
- **Sections par type** â€” Grouper avec emojis (ğŸš€ Features, ğŸ› Fixes, etc.)
- **Unreleased** â€” Section temporaire avant versionnement
- **Versionnement sÃ©mantique** â€” `[X.Y.Z] - YYYY-MM-DD`

### Archivage
- **Versions sÃ©parÃ©es** â€” `docs/versions/vX.Y.Z.md` pour historique
- **Nettoyage aprÃ¨s agrÃ©gation** â€” Supprimer les notes traitÃ©es (sauf `--keep`)
