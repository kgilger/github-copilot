# /commit — Commande de Commit Git Automatisée

## Description

Automatise le processus de commit git avec des messages formatés selon les conventions.
Analyse les changements, génère un message de commit structuré, et push automatiquement.

---

## Allowed Tools

- `git` — Uniquement les commandes git (status, diff, add, commit, push, log, branch)

---

## Validation

Avant exécution, vérifier :

- [ ] Être dans un repository git (`git rev-parse --git-dir`)
- [ ] Avoir des changements à committer (`git status --porcelain` non vide)
- [ ] Être sur une branche (pas en detached HEAD)

---

## Context

Collecter ces informations avant de commencer :

```bash
git status                      # État actuel du repo
git diff HEAD                   # Changements non commités
git branch --show-current       # Branche courante
git log --oneline -10           # 10 derniers commits (pour le style)
```

---

## Workflow

1. **Stage tous les fichiers**
   ```bash
   git add -A
   ```

2. **Analyser le diff staged**
   ```bash
   git diff --cached --stat      # Vue d'ensemble
   git diff --cached             # Détails si nécessaire
   ```

3. **Identifier le changement principal**
   - Quel est le type ? (`feat`, `fix`, `update`, `refactor`, `docs`, `chore`, `test`)
   - Quel est le scope ? (composant, module, fichier principal affecté)
   - Quelle est la description ? (action principale en 1 ligne)

4. **Générer le message de commit**
   - Format : `type(scope): description`
   - Intégrer `$ARGUMENTS` si fournis (ex: version, ticket)

5. **Committer**
   ```bash
   git commit -m "type(scope): description"
   ```

6. **Push**
   ```bash
   git push
   ```

---

## Rules

### Format du Message — OBLIGATOIRE

| Règle | Exemple ✅ | Contre-exemple ❌ |
|-------|-----------|-------------------|
| Format `type(scope): desc` | `fix(auth): resolve login bug` | `fix: resolve bug` |
| Scope TOUJOURS présent | `feat(cart): add checkout` | `feat: add checkout` |
| Max 72 caractères | `update(api): improve error handling` | Message trop long... |
| Pas de point final | `docs(readme): update install` | `docs(readme): update install.` |
| Présent, pas passé | `add user validation` | `added user validation` |
| Minuscule après `:` | `fix(auth): typo in config` | `fix(auth): Typo in config` |

### Types Autorisés

- `feat` — Nouvelle fonctionnalité
- `fix` — Correction de bug
- `update` — Mise à jour (non-breaking)
- `refactor` — Restructuration sans changement fonctionnel
- `docs` — Documentation uniquement
- `chore` — Maintenance (deps, config)
- `test` — Ajout/modification de tests

### Contraintes Absolues

- ❌ **Pas d'interactif** — Jamais de prompt utilisateur
- ❌ **Pas de verbose** — Messages concis uniquement
- ❌ **Pas de signatures** — Jamais "Generated by..." ou équivalent
- ✅ **Exit silencieux** — Si rien à committer, terminer sans message
- ✅ **Erreur concise** — Si push échoue, reporter l'erreur seulement

---

## Arguments

```
/commit $ARGUMENTS
```

### Usage

| Commande | Comportement |
|----------|--------------|
| `/commit` | Commit standard |
| `/commit V1.1` | Intègre "V1.1" dans le message |
| `/commit closes #42` | Intègre "closes #42" dans le message |
| `/commit WIP` | Préfixe avec "WIP: " |

### Parsing des Arguments

- Si `$ARGUMENTS` contient une version (`V1.0`, `v2.3.1`) → ajouter à la fin du message
- Si `$ARGUMENTS` contient un ticket (`#123`, `JIRA-456`) → ajouter à la fin
- Si `$ARGUMENTS` = `WIP` → préfixer le message avec `WIP: `
- Sinon → ajouter `$ARGUMENTS` tel quel à la fin du message

### Exemples avec Arguments

| Input | Message généré |
|-------|----------------|
| `/commit` | `feat(auth): add login endpoint` |
| `/commit V1.1` | `feat(auth): add login endpoint V1.1` |
| `/commit closes #42` | `fix(cart): resolve total calculation closes #42` |
| `/commit WIP` | `WIP: feat(auth): add login endpoint` |

---

## Execution

```
Priority: Speed > Detail

✅ DO:
- Keep commits atomic
- Keep history clean
- Push immediately after commit

❌ DON'T:
- Ask for user input
- Print verbose logs
- Add signatures
- Commit without scope
```

---

## Exemples de Messages

```
feat(auth): add user authentication
fix(api): resolve memory leak in connection pool
update(cart): improve error handling for edge cases
refactor(routes): simplify API route structure
docs(readme): update installation guide
chore(deps): update dependencies to latest
test(auth): add unit tests for login flow
```
